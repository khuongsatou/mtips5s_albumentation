<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Transformations</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Khi form upload được gửi
            $('form#upload-form').submit(function(e) {
                e.preventDefault(); // Ngăn chặn hành vi mặc định của form
                
                var formData = new FormData(this);

                $.ajax({
                    url: '/',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        $('#image-container').html($(response).find('#image-container').html());
                    }
                });
            });


        });

        function applyTransform(transformType, imagePath) {
            // Kiểm tra nếu imagePath không tồn tại
            if (!imagePath) {
                console.log("Không có đường dẫn ảnh");
                return;
            }

            // Gửi yêu cầu AJAX để thực hiện biến đổi
            $.ajax({
                url: '/transform',
                type: 'POST',
                data: {
                    'transform': transformType,
                    'image_path': imagePath
                },
                success: function(response) {
                    console.log("AJAX thành công");
                    // Cập nhật lại container với hình ảnh đã xử lý
                    $('#image-container').html($(response).find('#image-container').html());
                },
                error: function(xhr, status, error) {
                    console.log("Lỗi AJAX: ", error);
                }
            });
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Upload and Transform Image</h1>

        <!-- Form để tải lên ảnh -->
        <form id="upload-form" action="/" method="POST" enctype="multipart/form-data">
            <input type="file" name="file" accept="image/*">
            <button type="submit">Upload</button>
        </form>

        <!-- Hiển thị ảnh và các nút biến đổi -->
        <div id="image-container">
            {% if image_url %}
            <h2>Apply Transformations:</h2>
            <input type="hidden" name="image_path" value="{{ image_url }}">
            
            <!-- Các thẻ a thay cho nút submit -->
            <!-- Các thẻ a với onclick trực tiếp -->
            <a href="#" onclick="applyTransform('horizontal_flip', '{{ image_url }}'); return false;">Horizontal Flip</a>
            <a href="#" onclick="applyTransform('vertical_flip', '{{ image_url }}'); return false;">Vertical Flip</a>
            <a href="#" onclick="applyTransform('rotate_90', '{{ image_url }}'); return false;">Rotate 90</a>

            <!-- Hiển thị ảnh đã xử lý -->
            <h2>Processed Image:</h2>
            <img src="{{ image_url }}" alt="Processed Image" style="max-width: 100%; height: auto;">
            {% endif %}
        </div>
    </div>
</body>
</html>
